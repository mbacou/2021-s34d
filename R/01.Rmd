# Vietnam

Field work in Vietnam consisted of a qualitative assessment with focus group discussions and quantitative surveys. We first look at the consolidated survey results.

Notes:   

- 1 Int'l \$ = 7,473.67 VND (Vietnamese Dong) using [2020 World Bank PPP conversion rates](https://data.worldbank.org/indicator/PA.NUS.PPP) (1 Int'l \$ = 1 USD)
- Focus crop = **rice**
- Transportation costs are lumped into the cost of pesticides, fertilizers and harvesting.
- Labor costs are per hectare
- Inspection and certification fees are per farm (total fees for a single season). Only farmers who sell to **seed centers** or **seed companies** do incur these marketing costs.

## Survey Codebook

```{r}

xrate = 7473.67

# Load respondent data
hh <- fread("../data/vnm/hh.csv")
# Load group data
group <- fread("../data/vnm/group.csv")
# Load final codebook
lbl <- fread("../data/vnm/codebook.csv")

```

There are 21 variables and 60 observations in this set. A detailed codebook is shown below.

```{r}
kable(align="llccc", caption="Survey Codebook", lbl) %>%
  row_spec(ncol(hh), hline_after=T) %>%
  kable_def()
```

Recode variable names.

```{r}

setnames(hh, lbl$label, lbl$code, skip_absent=T)

```

Additional recodes of categorical variables.

```{r}

hh[, `:=`(
  hhid = paste("VNM", sub(" ", "0", format(1:.N, width=3)), sep=""),
  iso3 = "VNM",
  adm1_nm = factor(adm1_nm),
  group = factor(group),
  gender = factor(gender, labels=c(Nam="Male", Ná»¯="Female"))
)]

```


## Data Enrichment

Below we append some of the information that was recorded at the group level.

```{r}

# Merge
hh[group, on=.(group=Group), `:=`(
  group_year = Established,
  group_size = Members,
  soil_type = Soil,
  seasons = Seasons,
  irrigated = Irrigation,
  market_access = `Market access`,
  ttrade = `Transboundary trade`
)]

```


### Spatial Covariates

Using the **community GPS coordinates** we also suggest to enrich this dataset with additional biophysical and geospatial variables, e.g.:

- Agroecological zone
- Travel time to nearest market
- Population density
- Last season total rainfall
- Last season heat stress days (if any)

[pending GPS coordinates]


### Constructed Variables

We check farmer-reported total costs `costs_ha_lcu` against the sum of individual cost line items.

```{r}

hh[, 
  tran_ha_lcu := as.numeric(tran_ha_lcu)
][, 
  tran_ha_lcu := fifelse(is.na(tran_ha_lcu), 0, tran_ha_lcu)
][, costs_ha_lcu_imp := 
    # Per ha costs
    seed_ha_lcu + fert_ha_lcu + pest_ha_lcu + tran_ha_lcu + labor_ha_lcu + cert_lcu +
    # Per kg costs
    yield_ha_kg * (labl_kg_lcu + pckg_kg_lcu + mark_kg_lcu)]

hh[, summary(costs_ha_lcu_imp - costs_ha_lcu)]

```

There is no discrepancy between the 2 quantities, so we can assume that total costs are constructed per the formula above. No error was found.

Further we construct total sales `sales_ha_sh` and profit margin `margin_ha_sh` as percentages of total costs per hectare, and in PPP terms `sales_ha_ppp` and `margin_ha_ppp` to allow for cross country comparisons.

```{r}

hh[, `:=`(
  sales_ha_sh = sales_ha_lcu / costs_ha_lcu,
  margin_ha_sh = margin_ha_lcu / costs_ha_lcu,
  costs_ha_ppp = costs_ha_lcu / xrate,
  sales_ha_ppp = sales_ha_lcu / xrate,
  margin_ha_ppp = margin_ha_lcu / xrate,
  tfp = sales_ha_lcu / costs_ha_lcu
)]

```

Finally we normalize all farmer cost line items into a "long" table `hh_prod_cost` for charting.

```{r}

# Normalize production cost table
hh_prod_cost <- hh[, .(hhid,
  seeds = seed_ha_lcu, 
  fertilizer = fert_ha_lcu, 
  pesticides = pest_ha_lcu, 
  transport = tran_ha_lcu, 
  labor = labor_ha_lcu, 
  certification = cert_lcu,
  labeling = yield_ha_kg * labl_kg_lcu,
  packaging = yield_ha_kg * pckg_kg_lcu,
  marketing = yield_ha_kg * mark_kg_lcu
)]

hh_prod_cost <- melt(hh_prod_cost, id.vars=1, value.name="lcu", variable.name="category")
hh_prod_cost[, `:=`(
  # Add shares and PPP terms
  share = lcu/sum(lcu, na.rm=T),
  ppp = lcu/xrate
), by=hhid]

```

Note that in the current survey we are missing **farm sizes** (or planted acreage), so we can not directly study the effect of farm size on the per-unit costs of production and yields, or look at potential scale effects. We can however measure **partial factor productivity** as the ratio of total agricultural output to total production input (it is only partial here because the rental cost of land, land preparation costs, irrigation costs, and farm implements are missing). Furthermore we can measure a farmer's technical efficiency along the current production frontier.


## Descriptive Statistics

### Respondent Characteristics



### Seed Production Costs

We first look at the general distribution of production costs and sales receipts across farmer groups.

### Profit Margins

```{r}

ggplot(hh, aes(x=1:nrow(hh), color=group)) +
  geom_linerange(aes(ymin=costs_ha_ppp, ymax=sales_ha_ppp), size=.6) +
  geom_point(aes(y=costs_ha_ppp)) +
  geom_point(aes(y=sales_ha_ppp), shape=18, size=2) +
  scale_y_continuous(labels=comma) +
  labs(x=NULL, y=NULL, 
    title="Profit Margin per Ha (PPP$)",
    subtitle="Each bar is a respondent") +
  theme_def(legend.position="right")

ggplot(hh, aes(x=sales_ha_ppp-costs_ha_ppp, fill=group)) +
  geom_histogram(color="white") + 
  scale_x_continuous(labels=comma) +
  facet_wrap("group") +
  labs(x=NULL, y=NULL, 
    title="Profit Margin per Ha (PPP$)",
    subtitle="Each bar is a respondent") +
  theme_def()

```








```{r save-vnm}

rm(tmp, x, y, i)
save.image("../tmp/data_vnm.RData")

```
